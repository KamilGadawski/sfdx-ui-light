<template>
    <div class="slds-full-height">
        <div class="slds-full-height l-cell-auto-size l-container-horizontal">
            <div class="l-cell-auto-size">
                <div class="l-container-vertical">
                    <!-- Editor--> 
                    <div class="slds-flex-column slds-full-height slds-light-bg">
                        <div>
                            <div class="slds-grid"></div>
                            <lightning-tabset variant="scoped" class="slds-without-tab">
                                <lightning-tab label="Default" value="Default"  onactive={handleSelectTab}></lightning-tab>
                                <lightning-tab label="JSON"    value="JSON"     onactive={handleSelectTab}></lightning-tab>
                            </lightning-tabset>
                        </div>

                        <div class={defaultContainerClass}>
                            <template lwc:if={isArrayDisplayed}>
                                <!-- Details -->
                                <div class="slds-section slds-is-open">
                                    <h3 class="slds-section__title">
                                        <div class="slds-section__title-action">
                                            <span class="slds-truncate" title="Details">Details</span>
                                        </div>
                                    </h3>
                                    <div class="slds-section__content" >
                                        <div class="slds-grid slds-wrap slds-m-horizontal_x-small">
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Id</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.Id} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Type</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.attributes.type} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-1">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Url</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.attributes.url} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Developer Name</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.DeveloperName} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Full Name</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.FullName} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Language</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.Language} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Namespace Prefix</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.NamespacePrefix} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Audit Fields -->
                                <div class="slds-section slds-is-open">
                                    <h3 class="slds-section__title">
                                        <div class="slds-section__title-action">
                                            <span class="slds-truncate" title="Audit">Audit</span>
                                        </div>
                                    </h3>
                                    <div class="slds-section__content" >
                                        <div class="slds-grid slds-wrap slds-m-horizontal_x-small">
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Created Date</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.CreatedDate} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Created By</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.CreatedById} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Last Modified Date</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.LastModifiedDate} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-2">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Last Modified By</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.LastModifiedById} type="String"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col slds-size_1-of-1">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Is Deleted</label>
                                                    <div class="slds-form-element__control slds-m-left_x-small">
                                                        <metadata-viewer-value value={record.IsDeleted} type="boolean"></metadata-viewer-value>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Objects -->
                                <template for:each={formattedObjects} for:item="category">
                                    <div key={category.title} class="slds-section slds-is-open">
                                        <h3 class="slds-section__title">
                                            <div class="slds-section__title-action">
                                                <span class="slds-truncate" title={category.title}>{category.title}</span>
                                            </div>
                                        </h3>
                                        <div class="slds-section__content" >
                                            <template lwc:if={category.isArray}>
                                                <template lwc:if={category.header}>
                                                    <div class="max-height-400">
                                                        <lightning-datatable
                                                            data={category.rows}
                                                            columns={category.header}
                                                            key-field="_index"
                                                            hide-checkbox-column
                                                        ></lightning-datatable>
                                                    </div>
                                                </template>
                                                <template lwc:else>
                                                    <div class="slds-text-align_center"> No data</div>
                                                </template>
                                            </template>
                                            <template lwc:else>
                                                <div class="slds-grid slds-wrap slds-m-horizontal_x-small">
                                                    <template for:each={category.records} for:item="item" for:index="index">
                                                        <div key={item.field} class={item.class}>
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label">{item.field}</label>
                                                                <div class="slds-form-element__control slds-m-left_x-small">
                                                                    <metadata-viewer-value value={item.value} type={item.type}></metadata-viewer-value>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </template>
                        </div>

                        <div class={jsonContainerClass} lwc:dom="manual" lwc:ref="container"></div> 
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>