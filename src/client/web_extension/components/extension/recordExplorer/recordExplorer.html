<template>
    
    <div class="slds-full-height slds-flex-column">
        <!-- Header -->
        <div class="slds-p-vertical_x-small slds-p-horizontal_small slds-shrink-none">
            <template lwc:if={isRecordIdAvailable}>
                <!-- After loading -->
                <template lwc:if={displayRecordHeader}>
                    <div class="slds-grid">
                        <div class="slds-col slds-size_5-of-6">
                            <!-- Only if editing mode -->
                        </div>
                        <div class="slds-col slds-size_1-of-6">
                            <lightning-button-group class="slds-float_right">
                                <lightning-button-icon icon-name="utility:refresh" title="Refresh" disabled={isLoading} onclick={handleRefreshClick}></lightning-button-icon>
                            </lightning-button-group>
                        </div>
                    </div>
                    <!-- Object Info -->
                    <!--
                    <nav role="navigation" aria-label="Breadcrumbs">
                        <ol class="slds-breadcrumb slds-list_horizontal slds-wrap">
                            <li class="slds-breadcrumb__item">
                                <span>SObject</span>
                            </li>
                            <li class="slds-breadcrumb__item">
                                <a href={objectListLink}>{label}</a>
                            </li>
                        </ol>
                    </nav>
                    -->
                    <!-- Quick Links & Info -->
                    <dl class="slds-list_horizontal slds-wrap">
                        <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Record Id">
                            SObject
                        </dt>
                        <dd class="slds-item_detail slds-truncate">
                            <a href={objectListLink}>{label}</a>
                        </dd>
                        <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Record Id">
                            Record Id
                        </dt>
                        <dd class="slds-item_detail slds-truncate">
                            {keyPrefix} / {recordId} <lightning-button-icon
                                onclick={handleCopyId}
                                icon-name="utility:copy"
                                variant="bare"
                                alternative-text="copy"
                            ></lightning-button-icon>
                        </dd>
                        <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Links">
                        Links
                        </dt>
                        <dd class="slds-item_detail slds-truncate">
                            <a href={objectSetupLink} target="_blank">Setup</a> / <a href={objectFieldsSetupLink} target="_blank">Fields</a> / <a href={recordTypesLink} target="_blank">Records Types</a> / <a href={objectListLink} target="_blank">List</a>
                        </dd>
                        <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Documentation">
                            Documentation
                        </dt>
                        <dd class="slds-item_detail slds-truncate">
                            <a href={objectDocLink} target="_blank" onclick={redirectDoc}>{docLinkTitle}</a>
                        </dd>

                        <!-- Specific to Contacts -->
                        <template lwc:if={isNetworkMemberListDisplayed}>
                            <dt class="slds-item_label slds-text-color_weak slds-truncate" title="Login as">
                                Login as
                            </dt>
                            <dd class="slds-item_detail">
                                <template iterator:item={networkMembers}>
                                    <div key={item.value.Id} class="slds-inline-flex">
                                        <a href={item.value._redirectLink} target="_blank">{item.value.Network.Name}</a>
                                        <template lwc:if={item.last}>
                                        </template>
                                        <template lwc:else>
                                            <p class="slds-m-horizontal_x-small">|</p>
                                        </template>
                                    </div>
                                </template>
                                
                            </dd>
                        </template>
                        


                    </dl>
                </template>
            </template>
            <template lwc:else>
                <!-- Place Holder -->
                <slds-empty-illustration title="No record" sub-title="The extension only support standard record pages."></slds-empty-illustration>
            </template>
        </div>
        <!-- Table -->
        <div class="full-page-body tableFixHead" onscroll={handleScroll}>
            <template lwc:if={isLoading}>
                <div class="slds-text-align_center slds-text-color_weak slds-p-horizontal_medium">
                    <slds-spinner alternative-text="Loading" size="small" message="Fetching data from Salesforce"></slds-spinner>
                </div>
            </template>
            <template lwc:elseif={isSaving}>
                <div class="slds-text-align_center slds-text-color_weak slds-p-horizontal_medium">
                    <slds-spinner alternative-text="Saving" size="small" message="Updating data to Salesforce"></slds-spinner>
                </div>
            </template>
            <!--<div lwc:dom="manual" class="custom-table"></div>-->
            <table role="grid" class="slds-table slds-table_cell slds-table_fixed-layout slds-table_bordered slds-table_resizable-cols slds-no-row-hover" id="data-table">
                <thead>
                    <tr class="slds-line-height_reset head">
                        <th aria-label={fieldLabel} aria-sort="none" class="slds-is-sortable slds-is-resizable slds-text-title_caps" scope="col" id='leftColumn' draggable="false">
                            <div class="slds-th__action slds-text-link_reset">
                                <lightning-button-icon
                                        onclick={handleToggleFieldName}
                                        icon-name="utility:change_record_type"
                                        variant="bare"
                                        alternative-text="Switch Field &amp; Label"
                                ></lightning-button-icon>
                                <span class="slds-truncate slds-m-left_x-small" title={fieldLabel}>{fieldLabel}</span>
                            </div>
                        </th>
                        <th aria-label="Product Code" aria-sort="none" class="slds-is-sortable slds-is-resizable slds-text-title_caps" scope="col">
                            <div class="slds-th__action slds-text-link_reset">
                                <span class="slds-truncate" title="Product Code">Value</span>
                            </div>
                        </th>
                        <th aria-label="" aria-sort="none" class="" scope="col" style="width:30px;"></th>
                    </tr>
                </thead>
                <tbody id="data-toDisplay" class="record-explorer-table slds-scrollable_y" 
                    onenableeditmode={handleEnabledEditMode}
                    onfieldchange={handleRowInputChange}
                >
                    <!-- 
                        onregisterfielddependency={registerDependentField}
                        onupdatedependentfields={updateDependentFields}
                    -->
                    <!-- DATA are going here -->
                    <template for:each={virtualList} for:item="item">
                        <extension-record-explorer-row key={item.name} 
                            is-visible={item.isVisible}
                            is-label-displayed={isLabelDisplayed}
                            item={item} 
                            filter={filter} 
                            current-origin={currentOrigin} 
                            metadata={metadata}
                            record={record}
                            field-errors={fieldErrors}
                        ></extension-record-explorer-row>
                        <!-- is-edit-mode={isEditMode} -->
                    </template>
                </tbody>
            </table>
        </div>
        <!-- Only if editing mode -->
        <template lwc:if={isEditMode}>
            <div class="slds-editor-footer">
                <template lwc:if={isChangeMessageDisplayed}>
                    <div class="slds-grid slds-grid_align-center slds-p-top_x-small">
                        <p>
                            {modifiedRowsTotal} pending change(s)  
                            <lightning-button 
                                disabled={isSaving}
                                variant="base" 
                                label={viewChangeLabel} 
                                title={viewChangeLabel} 
                                class="slds-m-left_x-small"
                                onclick={handleViewChanges_filter}
                            ></lightning-button>
                        </p>
                    </div>
                </template>
                
                <div class="slds-grid slds-grid_align-center slds-p-vertical_x-small">
                    <lightning-button
                        disabled={isCancelButtonDisabled}
                        class="slds-float_left slds-button"
                        variant="neutral"
                        label="Cancel"
                        onclick={handleCancelClick}
                    ></lightning-button>
                    <lightning-button
                        disabled={isSaveButtonDisabled}
                        class="slds-button"
                        variant="brand"
                        label="Save"
                        onclick={handleSaveClick}
                    ></lightning-button>
                </div>
                <div class="slds-grid slds-grid_align-center slds-p-bottom_x-small">
                    <p>(Record Editing is currently in beta phase)</p>
                </div>
            </div>
        </template>
        
    </div>
    
</template>